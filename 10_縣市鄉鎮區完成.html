<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCd2fFmHB7xWd3E_Y3DWuVgomIqiclUkNE&callback=initMap&callback=initMap&libraries=&v=weekly"
        defer></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous">
    </script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        #map {
            width: 100%;
            height: 100%;
            /* display: flex; */
            /* position: absolute; */
            /* right: 0; */
        }

        html,
        body {
            height: 100%;
        }

        .dropdown-toggle::after {
            content: none;
        }

        .dropdown-menu-town {
            background-color: rgb(169, 189, 189);
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            /* border: 1px solid #fff; */
        }

        .dropdown-menu-townitem {
            width: 100%;
            text-decoration: none;
            color: #fff;
            padding: 0 1vw;
            cursor: pointer;
            /* background-color: aqua; */
        }

        @media screen and (min-width: 992px) {
            .navbar-collapse {
                width: fit-content;
            }
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <!-- <div class="container-fluid"> -->
                <a class="navbar-brand" href="#">台灣景點圖</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNavDarkDropdown" aria-controls="navbarNavDarkDropdown" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
                    <ul class="navbar-nav">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                北部
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li><a class="dropdown-item taipei" href="#">臺北市</a></li>
                                <li><a class="dropdown-item" href="#">新北市</a></li>
                                <li><a class="dropdown-item" href="#">基隆市</a></li>
                                <li><a class="dropdown-item" href="#">桃園市</a></li>
                                <li><a class="dropdown-item" href="#">新竹市</a></li>
                                <li><a class="dropdown-item" href="#">新竹縣</a></li>
                                <li><a class="dropdown-item" href="#">宜蘭縣</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                中部
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li><a class="dropdown-item" href="#">苗栗縣</a></li>
                                <li><a class="dropdown-item" href="#">臺中市</a></li>
                                <li><a class="dropdown-item" href="#">彰化縣</a></li>
                                <li><a class="dropdown-item" href="#">南投縣</a></li>
                                <li><a class="dropdown-item" href="#">雲林縣</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                南部
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li><a class="dropdown-item" href="#">嘉義市</a></li>
                                <li><a class="dropdown-item" href="#">嘉義縣</a></li>
                                <li><a class="dropdown-item" href="#">臺南市</a></li>
                                <li><a class="dropdown-item" href="#">高雄市</a></li>
                                <li><a class="dropdown-item" href="#">屏東縣</a></li>
                                <li><a class="dropdown-item" href="#">澎湖縣</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                東部
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li><a class="dropdown-item" href="#">花蓮縣</a></li>
                                <li><a class="dropdown-item" href="#">臺東縣</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                金馬
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink">
                                <li><a class="dropdown-item" href="#">金門縣</a></li>
                                <li><a class="dropdown-item" href="#">連江縣</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="container-fluid">
                    <div class="row town">
                        <div class="dropdown-menu-town">
                            <!--注意這裡目前是 div 可以考慮，改成ul?-->
                            <!-- <li><a class="dropdown-menu-townitem" href="#">恆春鎮</a></li> -->
                        </div>
                    </div>
                </div>
                <!-- </div> -->
            </nav>
        </div>
    </div>

    <div id="map"></div>

    <script>
        window.onload = (function () {
            getData();
        });

        let jsonData;
        let myNewArray = [];
        let zIndex = 0;

        function getData() {
            fetch("https://bsopendata.azurewebsites.net/api/LeisureTravel/Attractions", {})
                .then((response) => {
                    console.log(response);
                    return response.json();
                })
                .then((jsonData) => {
                    transForm(jsonData);
                })
                .catch((err) => {
                    console.log("錯誤:", err);
                });
        }

        function transForm(jsonObj) {
            let target = jsonObj.XML_Head.Infos.Info;
            target.forEach((item) => {
                //zIndex = zIndex + 1;
                myNewObj = {
                    id: item.Id,
                    name: item.Name,
                    description: item.Description,
                    tel: item.Tel,
                    address: item.Add,
                    region: item.Region,
                    town: item.Town,
                    px: item.Px,
                    py: item.Py,
                    //zindex: zIndex
                }
                myNewArray.push(myNewObj)
            });
        }

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: new google.maps.LatLng(25.0248603, 121.522363),
            });
        }

        // function showFlag() {
        //     myNewArray.forEach((element) => {
        //         new google.maps.Marker({
        //             position: {
        //                 lat: element.py,
        //                 lng: element.px
        //             },
        //             map: map,
        //         });
        //     });
        // }

        //--------------------------------------------

        //點擊北中南東離島綁事件跑showRegionMarker - 綁父層 - 取得子層縣市處理
        document.querySelector(".navbar-nav").addEventListener("click", showRegionMarker);

        //顯示出對應縣市的marker
        let regionMarkers = [];

        function showRegionMarker(e) {
            e.preventDefault(); //阻止a連結預設的跳轉網頁練習用
            regionMarkers.forEach((marker) => marker.setMap(null)); //消除前次縣市marker
            townMarkers.forEach((marker) => marker.setMap(null)); //消除前次鄉鎮區marker
            myNewArray.forEach((element) => {
                if (element.region == e.target.innerText) {
                    let marker = new google.maps.Marker({
                        position: {
                            lat: element.py,
                            lng: element.px
                        },
                        map: map,
                    });
                    regionMarkers.push(marker);
                }
            });
        }

        // ----------------------------

        //點擊縣市綁事件跑countTownFunc - 綁父層 - 取得子層縣市處理
        document.querySelector(".navbar-nav").addEventListener("click", countTownFunc);

        //顯示出縣市對應的鄉鎮區
        let countTown = [];
        let townDiv = document.querySelector(".dropdown-menu-town");

        function countTownFunc(e) {
            e.preventDefault();
            townDiv.innerHTML = "";
            countTown = [];
            myNewArray.forEach((element) => {
                if (element.region == e.target.innerText) {
                    countTown.push(element.town);
                }
            });
            //console.log(countTown);

            let result = countTown.sort().reduce((init, current) => {
                if (init.length === 0 || init[init.length - 1] !== current) {
                    init.push(current);
                }
                return init;
            }, []);
            //console.log(result);

            result.forEach((item) => {
                let li = document.createElement("li");
                let a = document.createElement("a");
                a.innerText = item;
                a.classList.add("dropdown-menu-townitem");
                li.setAttribute("data-region", e.target.innerText);
                li.setAttribute("class", "region-name");
                li.appendChild(a);
                townDiv.appendChild(li);
            });
        }

        //點擊縣市ul 綁父層跑showTownMarker - 取得子li處理
        document.querySelector(".dropdown-menu-town").addEventListener("click", showTownMarker);

        //顯示鄉鎮區marker
        let townMarkers = [];

        function showTownMarker(e) {
            let li = document.querySelector(".region-name");
            e.preventDefault(); //阻止a連結預設的跳轉網頁練習用
            regionMarkers.forEach((marker) => marker.setMap(null)); //消除前次縣市 marker
            townMarkers.forEach((marker) => marker.setMap(null)); //消除前次鄉鎮區 marker
            myNewArray.forEach((element) => {
                if (element.region == li.dataset.region &&
                    element.town == e.target.innerText) {
                    let marker = new google.maps.Marker({
                        position: {
                            lat: element.py,
                            lng: element.px
                        },
                        map: map,
                    });
                    townMarkers.push(marker);
                }
            });
        }


        //--------------------------------------------------------

        // const marker = new google.maps.Marker({
        //     position: {
        //         let: element.py,
        //         lng: element.px
        //     },
        //     // 動態產
        // });

        // marker.addEventListener(("click"), () => {
        //     infowindow.open(
        //         map, marker
        //     );
        // });


        // const infowindow = new google.maps.InfoWindow({
        //     content: contentString
        // });




        // This example displays a marker at the center of Australia.
        // When the user clicks the marker, an info window opens.
        // function initMap() {
        //     const uluru = {
        //         lat: -25.363,
        //         lng: 131.044
        //     };
        //     const map = new google.maps.Map(document.getElementById("map"), {
        //         zoom: 4,
        //         center: uluru,
        //     });
        //     const contentString =
        //         '<div id="content">' +
        //         '<div id="siteNotice">' +
        //         "</div>" +
        //         '<h1 id="firstHeading" class="firstHeading">Uluru</h1>' +
        //         '<div id="bodyContent">' +
        //         "<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large " +
        //         "sandstone rock formation in the southern part of the " +
        //         "Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) " +
        //         "south west of the nearest large town, Alice Springs; 450&#160;km " +
        //         "(280&#160;mi) by road. Kata Tjuta and Uluru are the two major " +
        //         "features of the Uluru - Kata Tjuta National Park. Uluru is " +
        //         "sacred to the Pitjantjatjara and Yankunytjatjara, the " +
        //         "Aboriginal people of the area. It has many springs, waterholes, " +
        //         "rock caves and ancient paintings. Uluru is listed as a World " +
        //         "Heritage Site.</p>" +
        //         '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">' +
        //         "https://en.wikipedia.org/w/index.php?title=Uluru</a> " +
        //         "(last visited June 22, 2009).</p>" +
        //         "</div>" +
        //         "</div>";
        //     const infowindow = new google.maps.InfoWindow({
        //         content: contentString,
        //     });
        //     const marker = new google.maps.Marker({
        //         position: uluru,
        //         map,
        //         title: "Uluru (Ayers Rock)",
        //     });
        //     marker.addListener("click", () => {
        //         infowindow.open(map, marker);
        //     });
        // }
    </script>
</body>

</html>